<?php
//désactivation des produits et destruction du lien famillial de certains produits SPICERS
//http://www.hook-network.com/storm/tasks/2011/04/21/suppression-produits-fournisseur-spicers-csv

require_once substr(dirname(__FILE__),0,strpos(dirname(__FILE__),'/',stripos(dirname(__FILE__),'technico')+1)+1).'config.php';

$db = DBHandle::get_instance();

// '001358', '001366', ,'001374'
//$refs = array('010441', '013349', '013720', '013801', '013836', '013852', '013860', '013879', '019721', '021946', '022127', '022356', '022495', '027294', '028447', '029090', '030610', '030954', '030995', '033868', '034655', '034758', '034766', '034809', '035049', '035656', '035664', '035672', '035680', '035698', '035704', '035712', '035720', '035738', '035745', '035753', '035761', '035778', '035896', '036116', '036477', '036485', '036574', '037688', '038286', '038294', '038301', '038318', '038326', '039341', '040294', '041339', '041347', '043305', '043321', '043904', '044098', '044121', '044138', '044162', '044462', '044685', '044986', '045004', '045133', '045141', '045725', '045733', '045741', '045758', '045774', '045782', '045790', '045806', '045999', '046279', '046287', '046295', '046376', '046580', '048902', '049614', '049811', '049846', '049889', '049951', '051792', '052151', '052508', '053236', '053244', '053325', '053333', '053351', '053386', '053718', '053734', '053742', '053769', '053785', '053852', '053904', '053939', '054136', '054144', '054152', '054264', '054994', '055008', '055016', '055081', '055098', '055210', '055284', '057453', '057568', '057583', '058995', '063578', '063846', '063951', '063978', '063994', '064094', '064272', '073982', '074031', '075711', '075738', '075827', '075967', '076572', '076604', '077981', '078011', '078028', '078122', '078611', '079501', '079568', '080660', '080678', '080685', '080896', '080978', '080985', '081153', '081161', '081178', '081186', '081194', '081218', '081268', '081283', '081291', '081315', '081323', '081356', '081749', '081870', '081896', '082011', '082424', '082477', '082538', '082595', '082610', '082628', '082635', '082651', '083266', '083396', '083403', '083428', '083500', '083518', '083866', '083890', '083922', '083948', '083971', '084001', '086223', '087074', '091398', '091460', '091766', '091774', '091782', '091790', '091806', '091822', '091871', '091888', '091896', '091903', '091911', '091928', '091936', '093758', '095355', '096727', '096743', '096778', '098945', '098953', '098961', '099008', '099016', '099024', '099032', '099040', '099098', '099169', '099864', '100021', '100048', '100798', '100805', '100821', '100895', '100968', '100976', '100984', '100992', '101006', '101014', '101022', '101030', '101048', '101055', '101063', '101071', '101216', '109795', '114991', '118005', '119035', '119761', '119818', '119826', '120028', '120043', '122562', '122570', '123825', '124156', '124164', '124172', '124180', '124198', '124245', '124253', '124261', '124695', '125739', '125755', '125852', '125894', '125941', '125954', '126912', '128572', '146736', '147491', '147505', '147513', '147599', '147610', '147629', '147637', '148411', '148438', '148446', '148470', '149271', '151038', '151046', '154348', '154356', '154364', '154372', '154542', '154698', '154704', '154712', '163709', '163759', '163775', '164445', '164461', '164568', '164623', '164665', '164673', '164681', '164738', '164790', '164806', '164814', '164822', '164830', '164848', '165486', '165753', '165814', '166089', '170578', '174052', '174060', '174079', '174109', '174421', '174551', '174940', '174998', '175158', '175166', '175952', '176541', '176568', '177593', '177602', '177781', '177798', '177856', '177984', '180606', '180614', '180622', '180630', '180648', '180655', '181027', '181078', '181115', '181116', '181123', '181131', '181159', '182062', '182070', '183745', '183753', '183761', '183770', '183788', '183924', '189882', '189890', '189930', '190924', '192469', '192485', '192493', '195749', '198702', '200432', '200440', '200459', '202572', '202883', '202912', '202945', '203332', '203421', '203454', '204329', '204337', '205778', '206972', '207112', '207198', '207228', '207546', '208642', '208942', '209236', '211688', '211735', '211743', '213345', '213831', '213856', '214601', '214652', '214660', '214679', '214695', '217292', '218069', '218093', '218107', '225195', '225332', '225632', '225640', '225658', '225665', '225698', '225713', '225721', '225746', '225754', '225770', '226214', '226385', '226400', '226678', '226725', '226806', '226814', '226822', '227098', '227348', '227356', '227364', '227518', '227526', '227534', '227542', '227575', '227583', '227591', '227648', '227672', '228002', '228165', '228440', '228458', '228465', '228473', '228643', '229071', '229200', '229233', '229282', '229290', '229306', '229314', '229363', '229371', '229436', '229518', '229606', '229622', '229630', '229688', '229696', '229785', '229858', '230010', '230124', '230465', '230473', '231129', '231137', '231145', '231258', '231266', '231274', '234394', '234730', '234748', '234750', '234755', '234763', '234784', '234807', '234849', '235004', '235061', '235078', '235126', '235394', '235848', '235920', '235938', '236008', '236754', '236762', '236834', '237530', '237660', '238938', '239006', '239014', '239022', '239030', '239048', '239056', '239145', '239153', '239161', '239195', '239200', '239218', '239307', '239315', '239323', '239331', '239349', '239381', '240194', '240275', '240291', '240461', '241424', '241432', '241440', '242330', '242996', '243075', '243083', '243091', '243164', '243220', '243238', '243245', '243253', '243261', '243278', '243286', '243294', '243301', '243318', '243326', '243334', '243342', '243350', '243368', '243375', '243383', '243391', '243408', '243415', '243423', '243431', '243448', '243464', '243545', '243894', '243950', '244370', '244428', '244435', '244508', '244532', '244540', '244565', '244573', '244581', '244598', '244605', '244613', '244638', '244646', '244654', '244662', '244670', '244688', '244695', '244702', '244710', '244728', '244735', '244743', '244902', '245188', '245196', '245211', '245228', '245293', '245300', '245325', '245333', '245341', '245358', '245366', '245374', '245382', '245544', '245735', '246361', '248073', '250393', '250482', '250490', '250506', '250514', '250522', '250530', '251692', '254673', '256273', '256281', '261045', '261061', '261118', '261134', '261150', '261169', '261177', '261223', '261231', '261258', '263732', '263740', '263935', '264055', '264128', '266091', '267622', '267630', '267664', '268643', '270135', '275249', '276568', '279509', '282247', '282255', '282271', '282297', '282336', '282344', '282409', '282417', '283852', '283878', '283886', '283894', '283917', '284372', '284420', '284518', '284542', '284615', '284698', '284794', '284875', '285155', '285721', '285739', '285747', '285755', '285789', '285797', '285902', '285910', '285945', '286126', '286328', '286336', '286344', '286459', '286630', '286665', '286681', '286738', '286746', '286770', '286789', '286797', '286800', '286819', '286827', '287242', '287577', '287652', '287705', '289412', '291557', '291638', '291866', '292139', '292405', '292421', '292594', '292641', '292895', '292918', '292926', '292934', '292942', '292968', '293175', '293183', '293191', '296811', '308235', '308251', '308277', '308285', '312320', '317407', '318942', '320326', '323575', '324449', '324465', '324910', '325698', '328557', '328581', '328603', '328611', '331210', '331229', '332013', '332240', '333328', '333336', '333440', '334918', '334926', '334934', '334942', '334950', '334969', '334977', '334985', '334993', '335018', '335026', '335034', '336592', '336607', '336615', '336657', '336681', '336699', '336712', '336738', '336788', '336835', '336851', '336869', '336877', '336885', '337087', '338990', '339042', '339050', '339068', '340996', '341014', '341022', '344394', '344469', '344718', '346221', '346328', '346584', '347309', '349350', '349369', '349377', '349423', '349458', '349852', '350497', '350675', '350683', '351476', '352560', '353183', '353191', '353311', '353338', '353389', '353397', '353443', '353451', '353557', '353573', '353581', '357264', '357272', '357337', '357942', '359438', '359446', '360299', '360355', '361776', '362992', '363033', '367922', '367949', '367957', '368859', '369472', '377606', '377622', '378517', '379563', '384049', '384057', '385932', '386236', '388021', '388152', '389038', '389046', '400237', '400417', '401135', '402506', '402956', '403099', '403942', '405454', '405496', '405527', '405828', '406247', '406574', '406841', '409635', '409643', '410887', '430954', '431453', '431488', '438124', '438159', '439219', '439227', '439820', '439847', '440224', '440225', '441867', '442438', '442447', '442587', '442595', '442617', '444194', '444209', '444217', '446932', '449733', '451145', '451674', '451758', '452069', '452239', '452328', '452352', '452493', '455501', '455527', '456289', '456328', '457797', '458310', '462961', '473254', '473513', '473521', '473548', '480522', '480549', '480557', '480565', '480611', '480638', '480646', '480890', '480904', '481842', '482156', '482514', '484473', '488053', '488959', '488967', '488975', '488983', '489180', '489458', '490471', '490633', '491124', '491353', '491361', '491388', '491931', '492073', '492081', '492103', '492746', '496865', '507087', '507532', '508015', '509894', '509916', '510033', '516818', '516826', '517589', '518983', '519911', '519938', '519946', '519989', '520005', '520099', '520153', '520366', '520900', '520919', '520951', '521493', '522456', '523834', '526890', '526920', '526939', '529306', '529314', '529365', '529411', '529438', '532135', '532143', '532151', '533377', '533385', '533393', '536292', '537124', '537441', '538978', '539175', '543803', '549333', '554562', '555746', '558318', '559283', '560248', '564690', '564770', '565148', '565776', '565814', '567068', '568063', '568616', '569875', '569965', '572636', '575390', '575659', '575802', '577463', '579197', '579201', '581904', '582039', '582217', '582225', '583612', '584005', '585524', '586758', '587842', '589194', '589533', '589585', '591642', '592889', '593295', '593309', '593317', '593368', '593473', '593481', '595520', '595806', '596879', '598659', '598667', '602289', '602297', '602319', '602327', '608354', '614021', '614048', '614315', '614684', '614692', '614706', '614714', '615493', '615647', '615671', '616073', '616553', '617427', '617702', '618147', '618600', '618627', '618725', '618733', '618806', '620361', '621234', '621294', '621391', '621480', '621499', '621510', '622949', '623227', '623529', '626010', '627254', '627262', '627289', '627297', '627326', '627334', '627342', '628666', '628674', '630995', '631001', '633735', '634162', '637117', '642063', '642071', '642232', '642756', '644829', '644837', '644845', '644853', '645808', '649559', '649605', '649613', '649621', '659240', '659258', '659868', '659876', '661181', '662383', '663265', '663273', '663479', '664063', '664958', '665327', '667403', '678447', '681518', '681748', '681756', '681828', '681844', '681976', '682556', '682963', '682998', '683500', '683764', '685919', '687200', '689732', '690780', '696244', '696295', '701422', '703901', '704435', '705032', '705155', '705163', '705171', '705189', '705278', '705634', '705650', '706346', '708540', '711193', '711460', '711509', '711525', '711861', '712211', '712238', '712246', '712254', '712270', '712505', '712513', '712651', '712718', '712724', '712910', '714295', '714326', '716656', '716680', '718083', '718091', '718211', '718229', '718910', '718936', '719826', '719850', '719868', '720179', '720550', '720568', '720978', '721856', '721864', '721880', '722770', '724194', '726762', '726962', '727046', '727199', '727204', '727709', '727717', '727725', '727822', '727911', '727979', '728194', '728209', '728225', '728364', '728372', '728398', '728673', '728699', '728704', '728712', '728720', '728746', '728754', '728762', '728770', '728788', '728796', '731705', '731925', '732328', '732394', '732605', '732645', '734174', '734221', '734240', '734865', '734873', '734881', '735014', '735412', '735420', '735543', '735551', '735577', '735608', '735616', '735705', '735959', '736108', '736132', '738776', '738784', '738792', '739705', '739836', '739852', '741353', '741434', '741947', '741989', '741997', '742057', '742081', '742099', '742138', '742154', '742170', '742188', '742277', '742308', '742332', '742340', '742358', '742366', '742405', '742421', '742447', '742471', '742489', '742497', '742502', '742510', '742528', '743771', '744009', '744076', '744130', '744203', '744528', '744536', '744544', '744594', '744633', '744646', '744772', '744786', '744798', '744803', '744824', '744840', '744890', '745013', '745028', '745078', '745117', '745993', '746018', '746247', '746271', '746298', '746301', '746808', '747412', '747633', '748575', '748582', '748590', '749125', '749133', '749175', '749183', '749191', '749214', '749646', '749715', '750029', '750037', '750053', '750061', '750281', '750354', '750396', '750477', '750508', '750590', '750613', '750786', '750794', '750809', '750817', '750825', '750833', '750875', '750891', '750968', '751008', '751147', '751197', '751202', '751343', '751735', '751820', '754684', '754867', '754875', '756197', '757901', '758503', '761331', '762485', '762493', '762507', '762515', '762523', '762531', '762558', '762566', '762574', '762620', '763057', '763065', '763103', '763111', '763154', '763162', '763375', '763383', '763391', '763405', '763413', '765997', '766372', '766461', '766593', '766674', '766682', '766895', '769661', '770657', '774631', '775810', '777068', '777137', '777385', '777408', '777474', '777482', '777994', '779154', '779848', '780070', '780224', '781438', '781807', '781815', '786289', '786394', '786409', '786687', '786815', '787276', '787373', '787747', '789917', '789925', '789933', '789941', '790138', '790146', '790154', '790162', '790212', '790247', '790413', '790463', '790544', '791222', '791230', '791921', '792976', '793230', '793719', '793743', '793751', '793769', '793793', '793963', '794112', '794196', '794219', '794235', '794243', '794536', '796285', '796293', '798916', '800918', '801175', '802293', '802324', '802332', '802340', '802358', '802366', '802374', '802382', '802390', '802405', '802413', '802455', '802463', '802586', '802594', '802609', '802625', '803224', '803256', '803264', '804510', '804536', '804544', '809921', '809939', '809947', '809955', '809963', '809971', '811841', '814056', '814064', '814072', '814080', '814099', '814110', '814129', '814137', '814145', '814153', '814161', '814171', '814196', '814206', '814218', '814226', '814234', '814242', '814250', '814269', '815812', '818007', '818015', '818176', '820716', '820732', '820740', '820758', '820774', '820782', '820790', '820805', '820821', '820889', '820897', '820902', '820910', '820928', '820936', '820952', '821046', '821062', '821088', '821096', '821119', '821127', '821135', '821143', '821151', '821185', '821193', '821208', '821216', '821224', '821232', '821240', '821258', '821266', '821339', '821363', '821397', '821428', '821834', '824627', '825831', '828287', '829444', '834186', '834241', '834267', '835521', '835830', '835898', '835987', '835995', '836097', '837432', '838233', '838241', '838259', '838267', '839157', '839165', '839173', '839181', '839199', '839296', '840611', '840629', '842116', '842124', '842166', '842174', '842221', '842239', '842247', '842255', '842815', '843022', '843030', '843048', '843056', '843064', '844247', '844483', '844491', '844514', '845569', '845593', '845917', '845925', '845933', '845941', '845959', '846784', '846792', '847412', '847438', '847470', '848328', '848718', '848726', '848920', '848938', '850609', '850625', '851612', '851638', '851701', '852586', '853005', '853989', '854007', '854015', '854023', '854031', '854308', '854316', '854324', '854798', '854926', '854942', '854976', '854992', '855125', '855133', '855507', '855654', '855662', '855670', '855688', '855696', '855701', '855719', '855905', '855913', '855921', '855939', '856023', '856031', '856049', '856057', '856081', '856104', '856112', '856120', '856138', '856154', '856162', '856170', '856188', '856196', '856201', '856219', '856227', '856772', '856780', '856798', '857060', '857078', '857280', '857298', '857303', '857379', '857387', '857395', '857400', '857418', '857426', '858551', '858568', '860961', '867259', '868655', '868663', '868689', '868697', '868702', '873981', '877321', '877703', '877711', '878059', '878300', '878457', '878643', '887068', '888047', '888055', '888128', '888136', '889987', '892140', '892158', '900184', '902762', '902770', '902983', '903601', '903628', '904828', '907832', '909930', '917499', '917502', '918354', '918362', '918567');
exit;
$where = '';
foreach ($refs as  $cle => $ref){
  
  if($cle != 0)
    $where .= ' or ';
  $where .= ' (rc.refSupplier = '.$ref .' and a.nom1 like \'%spicer%\')' ;
  
}

$query = 'select p.id
  from references_content rc
  join products p on p.id  =  rc.idProduct
  join advertisers a on p.idAdvertiser = a.id
  where '.$where;

//12921
//23830
//24597
//63403
  $res = $db->query($query);

  while($ret = $db->fetchAssoc($res)){
    $query1 = 'update products_fr set active = 0 where id = '.$ret['id'];
    if( $db->query($query1))
       echo 'produit '.$ret['id'].' désactivé'.PHP_EOL;
    else
      echo 'produit '.$ret['id'].' non désactivé'.PHP_EOL;
    
    $query2 = 'delete from products_families where idProduct = '.$ret['id'];
    if( $db->query($query2))
       echo 'lien famille '.$ret['id'].' détruit'.PHP_EOL;
    else
      echo 'lien famille '.$ret['id'].' non détruit'.PHP_EOL;
  }
?>
